<script>
var initKptLeaderboard = function() {
  // constants and global variables
  var types = ["kpt_challenge2016", "kpt_standard", "kpt_dev"];
  var metrics = ["AP", "AP_50", "AP_75", "AP_medium", "AP_large", "AR", "AR_50", "AR_75", "AR_medium", "AR_large"];
  var N=types.length, current={type:'kpt_challenge2016',team:-1}, data=new Array(N);
  for( var i=0; i<N; i++ ) data[i]={ main:[], refs:[], teams:[], cats:[] };
  // extract main data for leaderboard for all teams
  var loadData = function( entries ) {
    for( var i=0; i<N; i++ ) {
      for( var j=0; j<entries[types[i]].length; j++ ) {
        var e=entries[types[i]][j], name=e.team.name, r=JSON.parse(e.results);
        data[i].main[j] = new Array(2+metrics.length); data[i].main[j][0]=name;
        for( var k=0; k<metrics.length; k++ ) data[i].main[j][k+1] = r[metrics[k]];
        data[i].main[j][metrics.length+1] = e.date;
        if(e.url != "") name = "<a href='" + e.url + "' target='_blank'> " + name + " </a>";
        data[i].refs[j] = ["["+(j+1)+"] "+name, e.team.members, e.description];
        data[i].teams[j]=e.team.id; data[i].cats[j]=[];
      }
    }
    setData(current.type,current.team);
  };
  // function to set the data shown in the leaderboard and event binders
  var bindSetType=function(e,type) { var t=type; e.click( function(){setData(t,current.team)} )};
//  var bindSetTeam=function(e,team) { var t=team; e.click( function(){setData(current.type,t)} )};
  for( var i=0; i<N; i++ ) bindSetType($('#a_'+types[i]),types[i]);
  var setData = function( type, team ) {
    var i=$.inArray(type,types), j=$.inArray(team,data[i].teams);
    if(j==-1) team=-1; current.type=type; current.team=team;
    tableRefs.clear().rows.add(data[i].refs).draw();
    if( team==-1 ) {
      tableData.clear().rows.add(data[i].main).draw();
    } else if( data[i].cats[j].length>0 ) {
      tableData.clear().rows.add(data[i].cats[j]).draw();
      //bindSetTeam($('#clearTeam'),-1);
    }
  }
  // initialize and format DataTables https://www.datatables.net/
  var propsRefs = { 'paging':false, 'info':false, 'filter':false, 'sort':false, 'autoWidth':false };
  propsRefs.columnDefs = [{'targets':0,'sWidth':'20%'}];
  var propsData = { 'paging':false, 'info':false, 'order':[[1, 'desc']], 'dom':'fB<"toolbar_kpt">rtip' };
  propsData.buttons=[{extend:'copyHtml5',title:'leaderboard',exportOptions:{orthogonal:'export'},text:'Copy to Clipboard'}, {extend:'csvHtml5', title:'leaderboard',exportOptions:{orthogonal:'export'},text:'Export to CSV'}];
  propsData.columnDefs = [{'targets':0,'render':function(x,type,row,meta) {return (type==='export')?x:(current.team===-1)?x+'<sup>'+(meta.row+1)+'</sup>':'<span style="font-size:11px">'+x+'</span>'}}, {'targets':11,'render':function(x) {return '<span style="font-size:10px">'+x+'</span>'}}, {'targets':['_all'],'orderSequence':['desc', 'asc']}];
  var tableData = $('#leaderboard_kpt #data').DataTable(propsData);
  var tableRefs = $('#leaderboard_kpt #refs').DataTable(propsRefs);
  $('div.toolbar_kpt').css({'text-align':'center','padding-top':'4px','font-size':'14px'})
  // load core leaderboard data
  $.ajax({ type:'POST', url:'/leaderboard_get_kpts_entries/', data:{'team_id':0}})
    .done( function(json) {
            loadData(JSON.parse(json).entries)
            });
};
$( function() { initKptLeaderboard(); } );
</script>

<!------------------------------------------------------------------------------------------------>
<style>
  #leaderboard td { padding: 6px 4px; vertical-align:middle }
  #leaderboard th { padding: 6px 16px 6px 0px; text-align:right; width:36px }
</style>
<div style="font-size:13px; margin:10px;">
</div>
<div style="margin:10px 0px; display:inline-block">
  <ul class="nav nav-pills">
    <li class="active"><a data-toggle="tab" style="padding:10px" id="a_kpt_standard">Standard</a></li>
    <li><a data-toggle="tab" style="padding:10px" id="a_kpt_dev">Dev</a></li>
    <li><a data-toggle="tab" style="padding:10px" id="a_kpt_challenge2016">Challenge2016</a></li>
  </ul>
</div>
<div class="tab-content" id="leaderboard_kpt" style="font-size:12px">
  <table id="data" class="table order-column hover">
    <thead>
      <tr>
        <th style="width:200px"></th>
        <th>AP</th>
        <th>AP<sup>50</sup></th>
        <th>AP<sup>75</sup></th>
        <th>AP<sup>M</sup></th>
        <th>AP<sup>L</sup></th>
        <th>AR</th>
        <th>AR<sup>50</sup></th>
        <th>AR<sup>75</sup></th>
        <th>AR<sup>M</sup></th>
        <th>AR<sup>L</sup></th>
        <th style="width:70px">date</th>
      </tr>
    </thead>
  </table>
  <p class="fontTitle" style="margin-bottom:15px">Metrics</p>
  <div class="json fontMono">
    <div class="jsonreg"><b>Average Precision (AP):</b></div>
    <div class="jsonk">AP</div><div class="jsonv">% AP at OKS=.50:.05:.95 <b>(primary challenge metric)</b></div>
    <div class="jsonk">AP<sup>OKS=.50</sup></div><div class="jsonv">% AP at OKS=.50 (loose metric)</div>
    <div class="jsonk">AP<sup>OKS=.75</sup></div><div class="jsonv">% AP at OKS=.75 (strict metric)</div>
    <div class="jsonreg"><b>AP Across Scales:</b></div>
    <div class="jsonk">AP<sup>medium</sup></div><div class="jsonv">% AP for medium objects: 32<sup>2</sup> &lt; area &lt; 96<sup>2</sup></div>
    <div class="jsonk">AP<sup>large</sup></div><div class="jsonv">% AP for large objects: area &gt; 96<sup>2</sup></div>
    <div class="jsonreg"><b>Average Recall (AR):</b></div>
    <div class="jsonk">AR</div><div class="jsonv">% AR at OKS=.50:.05:.95</div>
    <div class="jsonk">AR<sup>OKS=.50</sup></div><div class="jsonv">% AR at OKS=.50</div>
    <div class="jsonk">AR<sup>OKS=.75</sup></div><div class="jsonv">% AR at OKS=.75</div>
    <div class="jsonreg"><b>AR Across Scales:</b></div>
    <div class="jsonk">AR<sup>medium</sup></div><div class="jsonv">% AR for medium objects: 32<sup>2</sup> &lt; area &lt; 96<sup>2</sup></div>
    <div class="jsonk">AR<sup>large</sup></div><div class="jsonv">% AR for large objects: area &gt; 96<sup>2</sup></div>
  </div>
  <p>Please see the <a href="#keypoints-eval">evaluation</a> page for more detailed information about the metrics.</p>
  <p class="fontTitle" style="margin-bottom:0px">References</p>
  <table id="refs" class="table table-striped hover" style="font-size:13px">
    <thead><tr>
      <th></th>
      <th></th>
      <th></th>
    </tr></thead>
  </table>
</div>
